L.SVG.include({_updateEllipse:function(t){t._point;var i=t._radiusX,s=t._radiusY,n=t._tiltDeg,a=t._endPointParams,e="M"+a.x0+","+a.y0+"A"+i+","+s+","+n+","+a.largeArc+","+a.sweep+","+a.x1+","+a.y1+" z";this._setPath(t,e)}}),L.Canvas.include({_updateEllipse:function(t){if(!t._empty()){var i=t._point,s=this._ctx,n=t._radiusX,a=(t._radiusY||n)/n;this._drawnLayers[t._leaflet_id]=t,s.save(),s.translate(i.x,i.y),0!==t._tilt&&s.rotate(t._tilt),1!==a&&s.scale(1,a),s.beginPath(),s.arc(0,0,n,0,2*Math.PI),s.restore(),this._fillStroke(s,t)}}}),L.Ellipse=L.Path.extend({options:{fill:!0,startAngle:0,endAngle:359.9},initialize:function(t,i,s,n){L.setOptions(this,n),this._latlng=L.latLng(t),s?this._tiltDeg=s:this._tiltDeg=0,i&&(this._mRadiusX=i[0],this._mRadiusY=i[1])},setRadius:function(t){return this._mRadiusX=t[0],this._mRadiusY=t[1],this.redraw()},getRadius:function(){return new L.point(this._mRadiusX,this._mRadiusY)},setTilt:function(t){return this._tiltDeg=t,this.redraw()},getBounds:function(){var t=this._getLngRadius(),i=this._getLatRadius(),s=this._latlng;return new L.LatLngBounds([s.lat-i,s.lng-t],[s.lat+i,s.lng+t])},setLatLng:function(t){return this._latlng=L.latLng(t),this.redraw(),this.fire("move",{latlng:this._latlng})},getLatLng:function(){return this._latlng},setStyle:L.Path.prototype.setStyle,_project:function(){var t=this._getLngRadius(),i=this._getLatRadius(),s=this._latlng,n=this._map.latLngToLayerPoint([s.lat,s.lng-t]),a=this._map.latLngToLayerPoint([s.lat-i,s.lng]);this._point=this._map.latLngToLayerPoint(s),this._radiusX=Math.abs(this._point.x-n.x),this._radiusY=Math.abs(a.y-this._point.y),this._tilt=Math.PI*this._tiltDeg/180,this._endPointParams=this._centerPointToEndPoint(),this._updateBounds()},_updateBounds:function(){var t=Math.sin(this._tilt),i=Math.cos(this._tilt),s=t*t,n=i*i,a=this._radiusX*this._radiusX,e=this._radiusY*this._radiusY,r=this._clickTolerance(),h=[Math.sqrt(a*n+e*s)+r,Math.sqrt(a*s+e*n)+r];this._pxBounds=new L.Bounds(this._point.subtract(h),this._point.add(h))},_update:function(){this._map&&this._updatePath()},_updatePath:function(){this._renderer._updateEllipse(this)},_getLatRadius:function(){return this._map.options.crs.infinite?this._mRadiusY:this._mRadiusY/40075017*360},_getLngRadius:function(){return this._map.options.crs.infinite?this._mRadiusX:this._mRadiusX/40075017*360/Math.cos(Math.PI/180*this._latlng.lat)},_centerPointToEndPoint:function(){var t=this._point,i=this._radiusX,s=this._radiusY,n=(this.options.startAngle+this.options.endAngle)*(Math.PI/180),a=this.options.startAngle*(Math.PI/180),e=this.options.endAngle,r=this._tiltDeg*(Math.PI/180),h=t.x+Math.cos(r)*i*Math.cos(a)+Math.sin(-r)*s*Math.sin(a),o=t.y+Math.sin(r)*i*Math.cos(a)+Math.cos(r)*s*Math.sin(a),u=t.x+Math.cos(r)*i*Math.cos(n)+Math.sin(-r)*s*Math.sin(n),l=t.y+Math.sin(r)*i*Math.cos(n)+Math.cos(r)*s*Math.sin(n);return{x0:h,y0:o,tilt:r,largeArc:e>180?1:0,sweep:e>0?1:0,x1:u,y1:l}},_empty:function(){return this._radiusX&&this._radiusY&&!this._renderer._bounds.intersects(this._pxBounds)},_containsPoint:function(t){var i=Math.sin(this._tilt),s=Math.cos(this._tilt),n=t.x-this._point.x,a=t.y-this._point.y,e=s*n+i*a,r=i*n-s*a;return e*e/(this._radiusX*this._radiusX)+r*r/(this._radiusY*this._radiusY)<=1}}),L.ellipse=function(t,i,s,n){return new L.Ellipse(t,i,s,n)};